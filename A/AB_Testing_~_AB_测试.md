
# A/B Testing

中文名：A/B 测试。

相比于蓝绿发布的流量切换方式，A/B 测试**基于用户请求的元信息将流量路由**到新版本，这是**一种基于请求内容匹配的灰度发布**策略。只有**匹配特定规则的请求才会被引流**到新版本，常见的做法包括基于 Http Header 和 Cookie。基于 Http Header 方式的例子，例如 User-Agent 的值为 Android 的请求 （来自安卓系统的请求）可以访问新版本，其他系统仍然访问旧版本。基于 Cookie 方式的例子，Cookie 中通常包含具有业务语义的用户信息，例如普通用户可以访问新版本，VIP 用户仍然访问旧版本。

如图，某服务当前版本为 v1，现在新版本 v2 要上线。希望安卓用户可以尝鲜新功能，其他系统用户保持不变。

![](https://img.liyunx.com/m1/TOIMG71d780318115429N.png ':size=70%')

通过在监控平台观察旧版本与新版本的成功率、RT 对比，当新版本整体服务预期后，即可将所有请求切换到新版本 v2，最后为了节省资源，可以逐步下线到旧版本 v1。

![](https://img.liyunx.com/m1/TOIMG83c5d0318115448N.png ':size=70%')

A/B 测试的优点：

- 可以对特定的请求或者用户提供服务新版本，新版本故障影响范围小；
- 需要构建完备的监控平台，用于对比不同版本之间请求状态的差异。

A/B 测试的缺点：

- 仍然存在资源冗余，因为无法准确评估请求容量；
- 发布周期长。

## 参考资料

- [一文读懂蓝绿发布、A/B 测试和金丝雀发布的优缺点](https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;amp;mid=2247504103&amp;amp;idx=3&amp;amp;sn=1673a56c43b4f414a3da449a23779557&amp;amp;chksm=fde8e287ca9f6b91907936d3f5a85f7e3946e3cde79d237abde29d2db868c59e83cff27425d6&amp;amp;scene=27#wechat_redirect)


