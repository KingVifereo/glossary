
# Canary releas

中文名：金丝雀发布、灰度发布。

在蓝绿发布中，由于存在流量整体切换，所以需要按照原服务占用的机器规模为新版本克隆一套环境，相当于要求原来 1 倍的机器资源。在 A/B 测试中，只要能够预估中匹配特定规则的请求规模，我们可以按需为新版本分配额外的机器资源。相比于前两种发布策略，**金丝雀发布的思想则是将少量的请求引流到新版本上**，因此部署新版本服务只需极小数的机器。**验证新版本符合预期后，逐步调整流量权重比例**，使得流量慢慢从老版本迁移至新版本，**期间可以根据设置的流量比例，对新版本服务进行扩容，同时对老版本服务进行缩容**，使得底层资源得到最大化利用。

如图，某服务当前版本为 v1，现在新版本 v2 要上线。为确保流量在服务升级过程中平稳无损，采用金丝雀发布方案，逐步将流量从老版本迁移至新版本。

![](https://img.liyunx.com/m1/TOIMG251f40319123031N.png ':size=50%')


金丝雀发布的优点：

- 按比例将流量无差别地导向新版本，新版本故障影响范围小；
- 发布期间逐步对新版本扩容，同时对老版本缩容，资源利用率高。

金丝雀发布的缺点：

- 流量无差别地导向新版本，可能会影响重要用户的体验；
- 发布周期长。

## 参考资料

- [一文读懂蓝绿发布、A/B 测试和金丝雀发布的优缺点](https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;amp;mid=2247504103&amp;amp;idx=3&amp;amp;sn=1673a56c43b4f414a3da449a23779557&amp;amp;chksm=fde8e287ca9f6b91907936d3f5a85f7e3946e3cde79d237abde29d2db868c59e83cff27425d6&amp;amp;scene=27#wechat_redirect)

